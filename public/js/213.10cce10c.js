"use strict";(self["webpackChunkepharma"]=self["webpackChunkepharma"]||[]).push([[213],{50213:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var n=a(56768),i={key:1},r={key:0},s=(0,n.Lk)("i",{class:"fa-solid fa-check"},null,-1),o={key:0},l=(0,n.Lk)("i",{class:"fa-solid fa-filter-circle-xmark text-primary"},null,-1),u={key:1},d=(0,n.Lk)("i",{class:"fa-solid fa-filter"},null,-1),c=(0,n.Lk)("i",{class:"fa-solid fa-ban"},null,-1),f={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},p=["id","value","onChange"];function h(e,t,a,h,v,y){var m=(0,n.g2)("ProgressBar"),b=(0,n.g2)("MoneyCounter"),k=(0,n.g2)("AsdecodeTable");return(0,n.uX)(),(0,n.CE)(n.FK,null,[!0===e.isLoading?((0,n.uX)(),(0,n.Wv)(m,{key:0,class:"my-1",mode:"indeterminate",style:{height:"6px"}})):(0,n.Q3)("",!0),e.inventaire_created?((0,n.uX)(),(0,n.CE)("div",i,[e.hasPermission("PRIVILEGES","inventaire_master")?((0,n.uX)(),(0,n.CE)("div",r,[e.lines>0?((0,n.uX)(),(0,n.Wv)(b,{key:e.keyCounter,compteurs:e.compteurs},null,8,["compteurs"])):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0),((0,n.uX)(),(0,n.Wv)(k,{useSearch:"",key:e.key,url:"/api/"+e.table+"?inventaire_id="+e.inventaire.id+"&show_diff_only="+e.showDiffOnly+"&rayon_libelle="+this.dialogRef.data.libelle,columns:e.columns,table:e.table,newKeyWord:e.keyWord,onSetTotalRecords:e.updateLines,onGetTableUrl:e.refreshCounters},{header_action_btns:(0,n.k6)((function(){return[(0,n.Lk)("button",{type:"button",class:"btn btn-light mr-2",onClick:t[0]||(t[0]=function(t){return e.updateInventaire("Terminé")})},[s,(0,n.eW)(" Terminer ")]),(0,n.Lk)("button",{type:"button",class:"btn btn-light mr-2",onClick:t[1]||(t[1]=function(){return e.SwitchWithDiff&&e.SwitchWithDiff.apply(e,arguments)})},[e.showDiffOnly?((0,n.uX)(),(0,n.CE)("span",o,[l,(0,n.eW)(" Tout afficher ")])):((0,n.uX)(),(0,n.CE)("span",u,[d,(0,n.eW)(" Ecart ")]))]),(0,n.Lk)("button",{class:"btn btn-danger ml-auto",onClick:t[2]||(t[2]=function(t){return e.updateInventaire("Annulé")})},[c,(0,n.eW)(" Annuler ")])]})),action_btns:(0,n.k6)((function(t){return[e.isLoadingInput[t.data.id]?((0,n.uX)(),(0,n.CE)("span",f)):((0,n.uX)(),(0,n.CE)("input",{key:1,type:"number",class:"form-control border border-dark px-[4rem]",id:t.data.id,min:"0",value:t.data.qte_reelle,onChange:function(a){return e.updateIventaireProduit(t.data,a)},style:{width:"100px"}},null,40,p))]})),_:1},8,["url","columns","table","newKeyWord","onSetTotalRecords","onGetTableUrl"]))])):(0,n.Q3)("",!0)],64)}var v=a(23772),y=a(41034),m=a(14048),b=a(30388),k=(a(28706),a(50113),a(51629),a(74423),a(44114),a(26099),a(21699),a(47764),a(23500),a(62953),a(11256)),g=a(46587),L=a.n(g),_=(0,n.$V)((function(){return a.e(427).then(a.bind(a,40427))}));const A=(0,n.pM)({name:"CreateInventairePartiel",inject:["dialogRef"],components:{MoneyCounter:k.A},data:function(){return{table:"inventaire_produit",isLoading:!1,isLoadingInput:[],showDiffOnly:!1,inventaire_created:!1,inventaire:!1,columns:[{key:"produit_libelle",label:"LIBELLE",exportable:!0},{key:"qte_reelle",label:"QTE REELLE",exportable:!0},{key:"qte",label:"QTE STOCK",exportable:!0},{key:"ecart",label:"ECART",exportable:!0},{key:"qte_finale",label:"QTE FINALE",exportable:!0},{key:"produit_cip",label:"CIP",exportable:!0},{key:"produit.prix_achat",label:"PRIX D'ACHAT",format:"money",exportable:!0},{key:"produit.prix_de_vente",label:"PRIX DE VENTE",format:"money",exportable:!0},{key:"rayon_libelle",label:"RAYON",exportable:!0}],compteurs:[],key:1,keyCounter:1,keyWord:"",form:{type:"Partiel",rayon_id:this.dialogRef.data.id,rayon:this.dialogRef.data.libelle}}},mounted:function(){this.createInventaire()},methods:{checkUrlFormat:function(e){return void 0!==e&&e.includes("?")?e+="&":e+="?",e},hasPermission:function(e,t){if(!this.$store.getters.habilitations)return!1;var a=this.$store.getters.habilitations.find((function(t){return t.menu===e}));return a&&a.submenus.includes(t)},createInventaire:function(){var e=this;this.isLoading=!0,this.axios.post("/api/inventaires",this.form).then((function(t){1==t.data.success?(e.inventaire=t.data.data,e.inventaire_created=!0,L()("#refreshinventaires").click(),e.$toast.add({severity:"success",detail:t.data.message,life:3e3})):t.data.errors.forEach((function(t){e.$toast.add({severity:"warn",summary:"Oups !",detail:t,life:7e3})})),e.isLoading=!1}))},updateInventaire:function(e){var t=this;this.$confirm.require({group:"headless",header:"Etes-vous sûr?",message:"Cette action est irréversible!",accept:function(){t.isLoading=!0;var a={statut:e};t.axios.post("/api/inventaires/"+t.inventaire.id+"/update",a).then((function(e){t.isLoading=!1,!0===e.data.success?(L()("#refreshinventaires").click(),t.$emit("line_updated"),t.$toast.add({severity:"success",detail:e.data.message,life:3e3}),t.dialogRef.close()):e.data.errors.forEach((function(e){t.$toast.add({severity:"warn",summary:"Oups !",detail:e,life:7e3})}))}))["catch"]((function(){t.isLoading=!1,t.$toast.add({severity:"error",summary:"Probleme de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur !",life:5e3})}))}})},openShowModal:function(e){this.$dialog.open(_,{props:{header:e.libelle,style:{width:"20vw"},modal:!0},data:e})},updateLines:function(e){var t=this;return(0,b.A)((0,m.A)().mark((function a(){return(0,m.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.calculerCoutTotal();case 2:t.lines=e;case 3:case"end":return a.stop()}}),a)})))()},searchLines:function(e){this.keyWord=e,this.key++},SwitchWithDiff:function(){1==this.showDiffOnly?this.showDiffOnly=!1:this.showDiffOnly=!0,this.key++},updateIventaireProduit:function(e,t){var a=this;return(0,b.A)((0,m.A)().mark((function n(){var i,r,s;return(0,m.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t.target.value,a.isLoadingInput=(0,y.A)((0,y.A)({},a.isLoadingInput),{},(0,v.A)({},e.id,!0)),e.qte_reelle=i,r={qte_reelle:i},n.prev=4,n.next=7,a.axios.post("/api/".concat(a.table,"/").concat(e.id,"/update"),r);case 7:s=n.sent,s.data.success?a.$toast.add({severity:"success",detail:s.data.message,life:3e3}):(s.data.errors.forEach((function(e){a.$toast.add({severity:"warn",summary:"Oups !",detail:e,life:7e3})})),t.target.value=e.qte_reelle),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](4),a.$toast.add({severity:"error",summary:"Probleme de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur !",life:5e3}),t.target.value=e.qte_reelle;case 15:return n.prev=15,a.isLoadingInput=(0,y.A)((0,y.A)({},a.isLoadingInput),{},(0,v.A)({},e.id,!1)),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,11,15,18]])})))()},calculerCoutTotal:function(){var e=this;this.isLoading=!0,this.axios.get("/api/inventaires-calc-compteur/"+this.inventaire.id).then((function(t){e.isLoading=!1,e.compteurs=[],e.compteurs.push({value:t.data.cout_total_achat,label:"VALEUR  DU STOCK À L'ACHAT"},{value:t.data.cout_total_achat_reel,label:"VAL À L'ACHAT AP"},{value:t.data.cout_total_vente_reel,label:"VAL À LA VENTE AP"},{value:t.data.diff_total_achat,label:"DIFF DU STOCK "}),e.keyCounter++}))["catch"]((function(){e.isLoading=!1,e.$toast.add({severity:"error",summary:"Probleme de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur !",life:5e3})}))}}});var C=a(71241);const x=(0,C.A)(A,[["render",h]]),E=x}}]);
//# sourceMappingURL=213.10cce10c.js.map