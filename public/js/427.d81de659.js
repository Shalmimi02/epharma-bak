"use strict";(self["webpackChunkepharma"]=self["webpackChunkepharma"]||[]).push([[427],{40427:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var n=a(56768),r={key:0},i=(0,n.Lk)("i",{class:"fa-solid fa-check"},null,-1),o={key:0},s=(0,n.Lk)("i",{class:"fa-solid fa-filter-circle-xmark text-primary"},null,-1),l={key:1},u=(0,n.Lk)("i",{class:"fa-solid fa-filter"},null,-1),d=(0,n.Lk)("i",{class:"fa-solid fa-ban"},null,-1),c={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},p=["id","value","onChange","disabled"];function f(e,t,a,f,b,h){var y=this,m=(0,n.g2)("MoneyCounter"),v=(0,n.g2)("ProgressBar"),k=(0,n.g2)("AsdecodeTable");return(0,n.uX)(),(0,n.CE)(n.FK,null,[e.hasPermission("PRIVILEGES","inventaire_master")?((0,n.uX)(),(0,n.CE)("div",r,[e.lines>0?((0,n.uX)(),(0,n.Wv)(m,{key:e.keyCounter,compteurs:e.compteurs},null,8,["compteurs"])):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0),!0===e.isLoading?((0,n.uX)(),(0,n.Wv)(v,{key:1,class:"my-1",mode:"indeterminate",style:{height:"6px"}})):(0,n.Q3)("",!0),(0,n.Lk)("div",null,[((0,n.uX)(),(0,n.Wv)(k,{useSearch:"",key:e.key,url:"/api/"+e.table+"?inventaire_id="+e.inventaire.id+"&show_diff_only="+e.showDiffOnly+"&rayon_libelle="+e.inventaire.rayon,columns:e.columns,table:e.table,newKeyWord:e.keyWord,onSetTotalRecords:e.updateLines,onGetTableUrl:e.refreshCounters},{header_action_btns:(0,n.k6)((function(){return[0==y.formLocked&&"Terminé"!=e.inventaire.statut&&"Annulé"!=e.inventaire.statut?((0,n.uX)(),(0,n.CE)("button",{key:0,type:"button",class:"btn btn-light mr-2",onClick:t[0]||(t[0]=function(t){return e.updateInventaire("Terminé")})},[i,(0,n.eW)(" Terminer ")])):(0,n.Q3)("",!0),(0,n.Lk)("button",{type:"button",class:"btn btn-light mr-2",onClick:t[1]||(t[1]=function(){return e.SwitchWithDiff&&e.SwitchWithDiff.apply(e,arguments)})},[e.showDiffOnly?((0,n.uX)(),(0,n.CE)("span",o,[s,(0,n.eW)(" Tout afficher ")])):((0,n.uX)(),(0,n.CE)("span",l,[u,(0,n.eW)(" Ecart ")]))]),0==y.formLocked&&"Terminé"!=e.inventaire.statut&&"Annulé"!=e.inventaire.statut?((0,n.uX)(),(0,n.CE)("button",{key:1,type:"button",class:"btn btn-danger ml-auto",onClick:t[2]||(t[2]=function(t){return e.updateInventaire("Annulé")})},[d,(0,n.eW)(" Annuler ")])):(0,n.Q3)("",!0)]})),action_btns:(0,n.k6)((function(t){return[e.isLoadingInput[t.data.id]?((0,n.uX)(),(0,n.CE)("span",c)):((0,n.uX)(),(0,n.CE)("input",{key:1,type:"number",class:"form-control border border-dark px-[4rem]",id:t.data.id,min:"0",value:t.data.qte_reelle,onChange:function(a){return e.updateIventaireProduit(t.data,a)},style:{width:"100px"},disabled:y.formLocked},null,40,p))]})),_:1},8,["url","columns","table","newKeyWord","onSetTotalRecords","onGetTableUrl"]))])],64)}var b=a(23772),h=a(41034),y=a(14048),m=a(30388),v=(a(28706),a(50113),a(51629),a(74423),a(44114),a(26099),a(21699),a(23500),a(11256)),k=a(46587),L=a.n(k);const E=(0,n.pM)({name:"CreateInventairePartiel",inject:["dialogRef"],components:{MoneyCounter:v.A},props:["formLocked","datas"],data:function(){return{table:"inventaire_produit",isLoading:!1,isLoadingInput:[],showDiffOnly:!1,inventaire:this.datas,columns:[{key:"produit_libelle",label:"LIBELLE",exportable:!0},{key:"qte_reelle",label:"QTE REELLE",exportable:!0},{key:"qte",label:"QTE EN STOCK",exportable:!0},{key:"ecart",label:"ECART",exportable:!0},{key:"qte_finale",label:"QTE FINALE",exportable:!0},{key:"produit_cip",label:"CIP",exportable:!0},{key:"produit_prix_achat",label:"PRIX D'ACHAT",format:"money",exportable:!0},{key:"produit_prix_de_vente",label:"PRIX DE VENTE",format:"money",exportable:!0}],key:1,keyCounter:1,keyWord:"",compteurs:[]}},methods:{checkUrlFormat:function(e){return void 0!==e&&e.includes("?")?e+="&":e+="?",e},hasPermission:function(e,t){if(!this.$store.getters.habilitations)return!1;var a=this.$store.getters.habilitations.find((function(t){return t.menu===e}));return a&&a.submenus.includes(t)},updateInventaire:function(e){var t=this;this.$confirm.require({group:"headless",header:"Etes-vous sûr?",message:"Cette action est irréversible!",accept:function(){t.isLoading=!0;var a={statut:e};t.axios.post("/api/inventaires/"+t.inventaire.id+"/update",a).then((function(e){t.isLoading=!1,!0===e.data.success?(L()("#refreshinventaires").click(),t.$emit("line_updated"),t.$toast.add({severity:"success",detail:e.data.message,life:3e3}),t.dialogRef.close()):e.data.errors.forEach((function(e){t.$toast.add({severity:"warn",summary:"Oups !",detail:e,life:7e3})}))}))["catch"]((function(){t.isLoading=!1,t.$toast.add({severity:"error",summary:"Probleme de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur !",life:5e3})}))}})},updateLines:function(e){var t=this;return(0,m.A)((0,y.A)().mark((function a(){return(0,y.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.calculerCoutTotal();case 2:t.lines=e;case 3:case"end":return a.stop()}}),a)})))()},searchLines:function(e){this.keyWord=e,this.key++},updateIventaireProduit:function(e,t){var a=this;return(0,m.A)((0,y.A)().mark((function n(){var r,i,o;return(0,y.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.target.value,a.isLoadingInput=(0,h.A)((0,h.A)({},a.isLoadingInput),{},(0,b.A)({},e.id,!0)),e.qte_reelle=r,i={qte_reelle:r},n.prev=4,n.next=7,a.axios.post("/api/".concat(a.table,"/").concat(e.id,"/update"),i);case 7:o=n.sent,o.data.success?a.$toast.add({severity:"success",detail:o.data.message,life:3e3}):(o.data.errors.forEach((function(e){a.$toast.add({severity:"warn",summary:"Oups !",detail:e,life:7e3})})),t.target.value=e.qte_reelle),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](4),a.$toast.add({severity:"error",summary:"Probleme de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur !",life:5e3}),t.target.value=e.qte_reelle;case 15:return n.prev=15,a.isLoadingInput=(0,h.A)((0,h.A)({},a.isLoadingInput),{},(0,b.A)({},e.id,!1)),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,11,15,18]])})))()},SwitchWithDiff:function(){1==this.showDiffOnly?this.showDiffOnly=!1:this.showDiffOnly=!0,this.key++},calculerCoutTotal:function(){var e=this;this.isLoading=!0,this.axios.get("/api/inventaires-calc-compteur/"+this.inventaire.id).then((function(t){e.isLoading=!1,e.compteurs=[],e.compteurs.push({value:t.data.cout_total_achat,label:"VALEUR  DU STOCK À L'ACHAT"},{value:t.data.cout_total_achat_reel,label:"VAL À L'ACHAT AP"},{value:t.data.cout_total_vente_reel,label:"VAL À LA VENTE AP"},{value:t.data.diff_total_achat,label:"DIFF DU STOCK "}),e.keyCounter++}))["catch"]((function(){e.isLoading=!1,e.$toast.add({severity:"error",summary:"Probleme de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur !",life:5e3})}))},getRayons:function(){var e=this;this.isLoading=!0,this.axios.get("/api/rayons/").then((function(t){e.rayons=t.data.data,e.isLoading=!1}))["catch"]((function(){e.isLoading=!1,e.$toast.add({severity:"error",summary:"Probleme de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur !",life:5e3})}))}},mounted:function(){this.hasPermission("PRIVILEGES","inventaire_master")?this.columns=[{key:"produit_libelle",label:"LIBELLE",exportable:!0},{key:"qte_reelle",label:"QTE REELLE",exportable:!0},{key:"qte",label:"QTE EN STOCK",exportable:!0},{key:"ecart",label:"ECART",exportable:!0},{key:"qte_finale",label:"QTE FINALE",exportable:!0},{key:"produit_cip",label:"CIP",exportable:!0},{key:"produit_prix_achat",label:"PRIX D'ACHAT",format:"money",exportable:!0},{key:"produit_prix_de_vente",label:"PRIX DE VENTE",format:"money",exportable:!0}]:this.columns=[{key:"produit_libelle",label:"LIBELLE",exportable:!0},{key:"produit_cip",label:"CIP",exportable:!0},{key:"produit_prix_achat",label:"PRIX D'ACHAT",format:"money",exportable:!0},{key:"produit_prix_de_vente",label:"PRIX DE VENTE",format:"money",exportable:!0}]}});var _=a(71241);const x=(0,_.A)(E,[["render",f]]),g=x}}]);
//# sourceMappingURL=427.d81de659.js.map